<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>AOP - Tag -</title><link>http://houugen.fun/tags/aop.html</link><description>AOP - Tag -</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Tue, 30 Mar 2021 09:00:00 +0000</lastBuildDate><atom:link href="http://houugen.fun/tags/aop.html" rel="self" type="application/rss+xml"/><item><title>NSProxy AOP</title><link>http://houugen.fun/posts/nsproxy-aop.html</link><pubDate>Tue, 30 Mar 2021 09:00:00 +0000</pubDate><author>Author</author><guid>http://houugen.fun/posts/nsproxy-aop.html</guid><description>iOS AOPæ–‡ç« ç³»åˆ—
å‰å¯¼çŸ¥è¯†ï¼š
Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ é™æ€é“¾æ¥&amp;amp;åŠ¨æ€é“¾æ¥ OCæ–¹æ³•&amp;amp;OCç±»&amp;amp;OCå¯¹è±¡ æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘ AOPæ¡†æ¶ï¼š
Method Swizzling Fishhook Apsects NSProxy AOP ä»‹ç» iOS æœ‰ä¸€ä¸ªåŸç”Ÿçš„ AOP æ–¹æ³•ï¼Œå°±æ˜¯åˆ©ç”¨ NSProxy ä»£ç†ç±»ï¼ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹å®˜ç½‘ä»‹ç»ï¼š
Typically, a message to a proxy is forwarded to the real object or causes the proxy to load (or transform itself into) the real object. Subclasses of NSProxy can be used to implement transparent distributed messaging (for example, NSDistantObject) or for lazy instantiation of objects that are expensive to create.</description></item><item><title>Apsects</title><link>http://houugen.fun/posts/apsects.html</link><pubDate>Mon, 29 Mar 2021 21:00:00 +0000</pubDate><author>Author</author><guid>http://houugen.fun/posts/apsects.html</guid><description>iOS AOPæ–‡ç« ç³»åˆ—
å‰å¯¼çŸ¥è¯†ï¼š
Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ é™æ€é“¾æ¥&amp;amp;åŠ¨æ€é“¾æ¥ OCæ–¹æ³•&amp;amp;OCç±»&amp;amp;OCå¯¹è±¡ æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘ AOPæ¡†æ¶ï¼š
Method Swizzling Fishhook Apsects NSProxy AOP ä»‹ç» Think of Aspects as method swizzling on steroids. It allows you to add code to existing methods per class or per instance, whilst thinking of the insertion point e.g. before/instead/after. Aspects automatically deals with calling super and is easier to use than regular method swizzling.
ä» Apsects çš„ä»‹ç»å¯ä»¥çœ‹åˆ°åˆ©ç”¨ swizzling æŠ€æœ¯æ¥è¾¾åˆ°ä¸ºç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•æ·»åŠ é¢å¤–é€»è¾‘ã€‚ä¸”æœ‰ before / instead / after ä¸‰ç§åœºæ™¯ã€‚</description></item><item><title>Fishhook</title><link>http://houugen.fun/posts/fishhook.html</link><pubDate>Thu, 25 Mar 2021 21:00:00 +0000</pubDate><author>Author</author><guid>http://houugen.fun/posts/fishhook.html</guid><description><![CDATA[iOS AOPæ–‡ç« ç³»åˆ—
å‰å¯¼çŸ¥è¯†ï¼š
 Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ é™æ€é“¾æ¥&amp;åŠ¨æ€é“¾æ¥ OCæ–¹æ³•&amp;OCç±»&amp;OCå¯¹è±¡ æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘  AOPæ¡†æ¶ï¼š
 Method Swizzling Fishhook Apsects NSProxy AOP   fishhook æ˜¯ facebook å¼€æºçš„ä¸€æ¬¾ç®€å•æ˜“ç”¨çš„åŠ¨æ€ hook æ¡†æ¶ã€‚ä¸€èµ·å­¦ä¹ ä¸‹å…¶åŸç†ã€‚
è¿˜æ˜¯é‚£ä¸ªğŸŒ° åœ¨ OCæ–¹æ³•&amp;OCç±»&amp;OCå¯¹è±¡ ä¸­è®²å…ƒç±»çš„æ—¶å€™åˆ†é…æ³¨å†Œäº†ä¸€ä¸ª Student ç±»ï¼Œå¹¶å®ç°äº† study æ–¹æ³•ï¼Œbut å­¦ç”Ÿè¡¨é¢å­¦ä¹ ï¼Œå†…å¿ƒè¿˜æ˜¯å‘å¾€è¯—å’Œè¿œæ–¹ï¼Œå› æ­¤æˆ‘ä»¬æƒ³é€šè¿‡ Fishhook åŠ¨æ€ Hook NSLog ç³»ç»Ÿå‡½æ•°æ¥è¡¨è¾¾å­¦ç”Ÿå…šçš„çœŸå®å†…å¿ƒï¼š
// main.m void StudyFunction(id self, SEL _cmd) { NSLog(@&#34;i am studing&#34;); } // å®šä¹‰å‡½æ•°æŒ‡é’ˆç”¨æ¥ä¿å­˜åŸå§‹å‡½æ•° static void (*orig_nslog)(NSString * format,...); // å®šä¹‰æ–°å‡½æ•°æ‰©å±• NSLog void newNSLog(NSString * format,...) { format = [format stringByAppendingFormat:@&#34;\tOS: i want to play!]]></description></item><item><title>Method Swizzling</title><link>http://houugen.fun/posts/method-swizzling.html</link><pubDate>Sat, 20 Mar 2021 21:00:00 +0000</pubDate><author>Author</author><guid>http://houugen.fun/posts/method-swizzling.html</guid><description><![CDATA[iOS AOPæ–‡ç« ç³»åˆ—
å‰å¯¼çŸ¥è¯†ï¼š
 Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ é™æ€é“¾æ¥&amp;åŠ¨æ€é“¾æ¥ OCæ–¹æ³•&amp;OCç±»&amp;OCå¯¹è±¡ æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘  AOPæ¡†æ¶ï¼š
 Method Swizzling Fishhook Apsects NSProxy AOP   iOS AOP æ¥ä¸‹æ¥çš„æ–‡ç« æˆ‘ä»¬æ­£å¼è¿›å…¥ iOS AOP çš„ä¸–ç•Œã€‚
AOP æ˜¯ä¸€ç§é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ä¸ä¿®æ”¹æºç æƒ…å†µä¸‹ç»™ç¨‹åºæ·»åŠ åŠŸèƒ½çš„æŠ€æœ¯ã€‚
æ ¹æ® OC çš„ runtime ç‰¹æ€§ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç»æ¯”è¾ƒåŸºç¡€çš„ä¸€ç§å®ç°æ–¹å¼ &ndash; Method Swizzlingã€‚
ğŸŒ° æ¼”ç¤º æˆ‘ä»¬ä¾æ—§ä½¿ç”¨ å‰å¯¼çŸ¥è¯†æ–‡ç«  ä¸­çš„ Demoï¼Œå…ˆä¸º Person æ·»åŠ ä¸€ä¸ª Category ç±»æ¥æ‰©å±•ä¸€ä¸ª eat æ–¹æ³•ï¼Œæ¯•ç«Ÿå¹²é¥­äººé™¤äº†ç¡è¿˜è¦åƒï¼Œè¦ä¸å’Œå’¸é±¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæˆ‘ä»¬æƒ³åœ¨ äºº ç¡å‰å…ˆ åƒé¥±é¥­ï¼Œè¯¥å¦‚ä½•åˆ©ç”¨ Swizzling å®ç°å‘¢ï¼Ÿ
// Person.m @implementation Person - (void)sleep { NSLog(@&#34;i am sleeping&#34;); } @end // Person+swizzle.m @implementation Person (swizzle) - (void)eat { NSLog(@&#34;i am eating&#34;); // è¿™é‡Œè°ƒç”¨è‡ªèº«å¹¶ä¸ä¼šå¯¼è‡´é€’å½’è°ƒç”¨  // å› ä¸ºåœ¨ main ä¸­äº¤æ¢äº† eat å’Œ sleep çš„ IMPï¼Œæ‰€ä»¥è¿™é‡Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ sleep  [self eat]; } @end // main.]]></description></item><item><title>æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘</title><link>http://houugen.fun/posts/%E6%96%B9%E6%B3%95%E6%9F%A5%E6%89%BE%E5%92%8C%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91.html</link><pubDate>Mon, 15 Mar 2021 21:00:00 +0000</pubDate><author>Author</author><guid>http://houugen.fun/posts/%E6%96%B9%E6%B3%95%E6%9F%A5%E6%89%BE%E5%92%8C%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91.html</guid><description>iOS AOPæ–‡ç« ç³»åˆ—
å‰å¯¼çŸ¥è¯†ï¼š
Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ é™æ€é“¾æ¥&amp;amp;åŠ¨æ€é“¾æ¥ OCæ–¹æ³•&amp;amp;OCç±»&amp;amp;OCå¯¹è±¡ æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘ AOPæ¡†æ¶ï¼š
Method Swizzling Fishhook Apsects NSProxy AOP Tip æºç åˆ†æç¯å¢ƒï¼šobjc4-818.2 æ ¹æ®ä¹‹å‰çš„æ–‡ç« æˆ‘ä»¬çŸ¥é“OCæ–¹æ³•çš„æœ¬è´¨å°±æ˜¯è°ƒç”¨ obj_msgSendï¼Œé‚£ä¹ˆæˆ‘ä»¬å…·ä½“åˆ†æä¸‹ ObjC ä¸‹æ–¹æ³•çš„æŸ¥æ‰¾å’Œè½¬å‘æœºåˆ¶ã€‚
obj_msgSend çš„å®ç°åœ¨ obj-msg-rm64.s ä¸­çš„æ±‡ç¼–ä»£ç ä¸ºï¼š
ENTRY _objc_msgSend UNWIND _objc_msgSend, NoFrame cmp p0, #0 // nil check and tagged pointer check #if SUPPORT_TAGGED_POINTERS b.le LNilOrTagged // (MSB tagged pointer looks negative) #else b.eq LReturnZero #endif ldr p13, [x0] // p13 = isa GetClassFromIsa_p16 p13, 1, x0 // p16 = class LGetIsaDone: // calls imp or objc_msgSend_uncached CacheLookup NORMAL, _objc_msgSend, __objc_msgSend_uncached #if SUPPORT_TAGGED_POINTERS LNilOrTagged: b.</description></item><item><title>OCæ–¹æ³•&amp;OCç±»&amp;OCå¯¹è±¡</title><link>http://houugen.fun/posts/oc%E6%96%B9%E6%B3%95oc%E7%B1%BBoc%E5%AF%B9%E8%B1%A1.html</link><pubDate>Wed, 10 Mar 2021 21:00:00 +0000</pubDate><author>Author</author><guid>http://houugen.fun/posts/oc%E6%96%B9%E6%B3%95oc%E7%B1%BBoc%E5%AF%B9%E8%B1%A1.html</guid><description><![CDATA[iOS AOPæ–‡ç« ç³»åˆ—
å‰å¯¼çŸ¥è¯†ï¼š
 Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ é™æ€é“¾æ¥&amp;åŠ¨æ€é“¾æ¥ OCæ–¹æ³•&amp;OCç±»&amp;OCå¯¹è±¡ æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘  AOPæ¡†æ¶ï¼š
 Method Swizzling Fishhook Apsects NSProxy AOP   Tip  æºç åˆ†æç¯å¢ƒï¼šobjc4-818.2   OCæ–¹æ³• é€šè¿‡ä¹‹å‰çš„æ–‡ç«  Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ æˆ‘ä»¬å¾—çŸ¥OCæ–¹æ³•åœ¨ç¼–è¯‘æ—¶è°ƒç”¨äº† objc_msgSend å‡½æ•°
int main(int argc, const char * argv[]) { @autoreleasepool { // insert code here...  NSLog(@&#34;Hello, World!&#34;); Person *p = [[Person alloc] init]; [p walk]; [p ill]; [p sleep]; run(); } return 0; } clang -rewrite-objc main.m -o main.cpp]]></description></item><item><title>é™æ€é“¾æ¥&amp;åŠ¨æ€é“¾æ¥</title><link>http://houugen.fun/posts/%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5.html</link><pubDate>Fri, 05 Mar 2021 21:00:00 +0000</pubDate><author>Author</author><guid>http://houugen.fun/posts/%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5.html</guid><description>iOS AOPæ–‡ç« ç³»åˆ—
å‰å¯¼çŸ¥è¯†ï¼š
Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ é™æ€é“¾æ¥&amp;amp;åŠ¨æ€é“¾æ¥ OCæ–¹æ³•&amp;amp;OCç±»&amp;amp;OCå¯¹è±¡ æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘ AOPæ¡†æ¶ï¼š
Method Swizzling Fishhook Apsects NSProxy AOP é™æ€é“¾æ¥ è¿˜æ˜¯é€šè¿‡ ğŸŒ° æ¥åˆ†æï¼š
âœ ios cat bar.c int global = 1; void fizz(int a) { global = a; } âœ ios cat main.c extern int global; void fizz(int a); int main() { fizz(100 + global); return 0; } ç¼–è¯‘é“¾æ¥ bar.c å’Œ main.c ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ main
âœ ios xcrun -sdk iphoneos clang -c bar.</description></item><item><title>Mach-O æ–‡ä»¶ç»“æ„åˆ†æ</title><link>http://houugen.fun/posts/mach-o%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90.html</link><pubDate>Mon, 01 Mar 2021 21:00:00 +0000</pubDate><author>Author</author><guid>http://houugen.fun/posts/mach-o%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90.html</guid><description>iOS AOPæ–‡ç« ç³»åˆ—
å‰å¯¼çŸ¥è¯†ï¼š
Mach-Oæ–‡ä»¶ç»“æ„åˆ†æ é™æ€é“¾æ¥&amp;amp;åŠ¨æ€é“¾æ¥ OCæ–¹æ³•&amp;amp;OCç±»&amp;amp;OCå¯¹è±¡ æ–¹æ³•æŸ¥æ‰¾å’Œæ¶ˆæ¯è½¬å‘ AOPæ¡†æ¶ï¼š
Method Swizzling Fishhook Apsects NSProxy AOP äºŒè¿›åˆ¶ç»“æ„ ä½¿ç”¨ MachoView å·¥å…·æŸ¥çœ‹äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼Œç»“æ„ä¸ºï¼š
Header å¤´ä¸­é­”æœ¯æ•°å­—ï¼š
å¯æ‰§è¡Œæ ¼å¼ magic ç”¨é€” è„šæœ¬ \x7FELF ä¸»è¦ç”¨äº shell è„šæœ¬ï¼Œä½†æ˜¯ä¹Ÿå¸¸ç”¨è¯­å…¶ä»–è§£é‡Šå™¨ï¼Œå¦‚ Perl, AWK ç­‰ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è§çš„è„šæœ¬æ–‡ä»¶ä¸­åœ¨ #! æ ‡è®°åçš„å­—ç¬¦ä¸²ï¼Œå³ä¸ºæ‰§è¡Œå‘½ä»¤çš„æŒ‡ä»¤æ–¹å¼ï¼Œä»¥æ–‡ä»¶çš„ stdin æ¥ä¼ é€’å‘½ä»¤ é€šç”¨äºŒè¿›åˆ¶æ ¼å¼ 0xcafebabe 0xbebafeca åŒ…å«å¤šç§æ¶æ„æ”¯æŒçš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œåªåœ¨ macOS ä¸Šæ”¯æŒ Mach-O 0xfeedfaceï¼ˆ32 ä½ï¼‰ 0xfeedfacfï¼ˆ64 ä½ï¼‰ macOS çš„åŸç”ŸäºŒè¿›åˆ¶æ ¼å¼ Mach-O ä¸»è¦ä¸‰éƒ¨åˆ†ï¼š</description></item></channel></rss>