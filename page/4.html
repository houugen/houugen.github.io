<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.82.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title></title><meta name=Description content="This is Houugen's Hugo Site"><meta property="og:title" content><meta property="og:description" content="This is Houugen's Hugo Site"><meta property="og:type" content="website"><meta property="og:url" content="http://houugen.fun/"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="This is Houugen's Hugo Site"><meta name=application-name content><meta name=apple-mobile-web-app-title content><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://houugen.fun/><link rel=alternate href=/index.xml type=application/rss+xml title><link rel=feed href=/index.xml type=application/rss+xml title><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"http:\/\/houugen.fun\/","inLanguage":"en","author":{"@type":"Person","name":"Houugen"},"description":"This is Houugen's Hugo Site","name":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title>Houugen<span class=header-title-post>モブ</span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts.html>Posts </a><a class=menu-item href=/tags.html>Tags </a><a class=menu-item href=/categories.html>Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title>Houugen<span class=header-title-post>モブ</span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts.html title>Posts</a><a class=menu-item href=/tags.html title>Tags</a><a class=menu-item href=/categories.html title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page home" posts><div class=home-profile><div class=home-avatar><a href=/posts.html title=Posts><img class=lazyload src=/svg/loading.min.svg data-src=/images/avatar.png data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" data-sizes=auto alt=/images/avatar.png title=/images/avatar.png></a></div><h2 class=home-subtitle><div id=id-1 class=typeit></div></h2><div class=links><a href=https://github.com/https://github.com/ title=GitHub target=_blank rel="noopener noreffer me"><i class="fab fa-github-alt fa-fw"></i></a><a href=https://twitter.com/https://twitter.com/Dino_Boom_ title=Twitter target=_blank rel="noopener noreffer me"><i class="fab fa-twitter fa-fw"></i></a><a href=mailto:lzm-6121@163.com title=Email rel=" me"><i class="far fa-envelope fa-fw"></i></a></div></div><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/dasp-unchecked-return-valuse-4.html>#DASP# Unchecked Return Valuse (4)</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i>Houugen</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-08-03>2018-08-03</time></span>&nbsp;<span class=post-category>included in <a href=/categories/%E5%8C%BA%E5%9D%97%E9%93%BE.html><i class="far fa-folder fa-fw"></i>区块链</a></span></div><div class=content>0x00 Info Unchecked Return Values For Low Level Calls漏洞简单理解就是没有检查一些不安全调用函数的返回值导致。
0x01 CALL -> Contract 在reentrancy漏洞介绍中提到几种账户间转币函数，这里我们回顾并深入了解下：
函数 特性 address.transfer() 1. 失败抛出异常且回滚 2. 提供2300gas，防止reentrancy address.send() 1. 失败返回false 2. 提供2300gass，防止reentrancy address.call.value().gas()() 1. 失败返回false 2. 发送所有可用gas 在这些交易函数中需要注意的是：
addr.transfer()和addr.send()能够防止重入漏洞。但是这些方法会触发fallback函数执行，被调合约仅被提供2300gas做一些日志事件。 x.transfer(y)等同于require(x.send(y))，transfer在发送失败时会自动revert（内置失败处理）。 addr.call.value(y)()也会触发代码执行，但是会用所有提供的gas执行代码，当然这种方式不能防止reentrancy漏洞。 通过了解以上我们会提出一些疑问：
2300gas由谁来提供？为何是2300gas? 2300gas能做什么？ 哪些行为会导致发送失败？ 要回答这些问题，首先要知道一个知识点，transfer、send、call在EVM虚拟机执行时会将这些solidity编译成 CALL 指令，而在以太坊wiki中定义了CALL的gas消耗：
Quote CALL has a multi-part gas cost: 700 base 9000 additional if the value is nonzero 25000 additional if the destination account does not yet exist (note: there is a difference between zero-balance and nonexistent!</div><div class=post-footer><a href=/posts/dasp-unchecked-return-valuse-4.html>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/blockchain.html>BlockChain</a>,&nbsp;<a href=/tags/dasp.html>DASP</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/dasp-arithmetic-issues-3.html>#DASP# Arithmetic Issues (3)</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i>Houugen</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-07-25>2018-07-25</time></span>&nbsp;<span class=post-category>included in <a href=/categories/%E5%8C%BA%E5%9D%97%E9%93%BE.html><i class="far fa-folder fa-fw"></i>区块链</a></span></div><div class=content>0x00 Info Arithmetic Issues为DASP TOP10的第三类漏洞。这类算数漏洞比较常见
also known as integer overflow and integer underflow
0x01 原理 整型溢出的原理很简单，以8位整型为例，借图说明上溢。
8位无符号整型范围[0, 255]:
8位有符号整型范围[-128, 127]:
对于下溢 (unit8)0-1=(uint8)255, (int8)(-128)-1=(int8)127.
0x02 场景 对于智能合约常见的整型溢出漏洞，会出现在如下场景：
经典场景，没有检查下溢 function withdraw(uint _amount) { require(balances[msg.sender] - _amount > 0); // 如果 _amount > msg.sender, underflow msg.sender.transfer(_amount); // 会transfer一个很大的值 balances[msg.sender] -= _amount; } off-by-one function popArrayOfThings() { require(arrayOfThings.length >= 0); arrayOfThings.length--; // length是uint，当length=0，length--会下溢翻转；同样++也需要注意 } 关键字var var会根据分配值更改为最小适配类型，下例中i=0，因此i被分配为uint8。因此i最大255，当somethingLarge>256时，i就会上溢。 for (var i = 0; i &lt; somethingLarge; i ++) { // .</div><div class=post-footer><a href=/posts/dasp-arithmetic-issues-3.html>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/blockchain.html>BlockChain</a>,&nbsp;<a href=/tags/dasp.html>DASP</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/dasp-access-control-2.html>#DASP# Access Control (2)</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i>Houugen</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-07-24>2018-07-24</time></span>&nbsp;<span class=post-category>included in <a href=/categories/%E5%8C%BA%E5%9D%97%E9%93%BE.html><i class="far fa-folder fa-fw"></i>区块链</a></span></div><div class=content>0x00 Info 本篇为DASP TOP10的第二类漏洞Access Control。通过Parity及Rubixi合约分析理解此类型漏洞，改写OpenZeppelin中题目辅助理解。
0x01 Access Control 概念：攻击者通过合约不安全的可见性设置时可以直接访问合约的私有变量和函数，这其中需要可能需要绕过一些访问控制。
在使用 Solidity 编写合约代码时，有几种默认的变量或函数访问域关键字：private, public, external 和 internal，对合约实例方法来讲，默认可见状态为 public，而合约实例变量的默认可见状态为 private。 具体讲解参见solidity develop visibility 这里需要重点关注下external和internal，external函数为合约接口，只能被其他合约调用（在自身需通过this.f()调用）。而internal函数只能被自身调用。
此类漏洞经常会发生在以下场景：
合约使用已经遗弃的tx.origin验证调用者 通过很长的require处理大量的认证逻辑 通过delegatecall调用代理库或者代理合约 通俗讲就是一般的智能合约会通过初始化指定合约的拥有者，来实现类似赋予特权后收回合约资金的功能。而初始化函数如果能被任何人调用的话，攻击者就会将自己成为合约拥有者进行提币或恶意操作。
这里最著名的漏洞就是Parity Wallet Hack。但在介绍该漏洞前需要理解一些solidity知识。
0x02 tx.origin Solidity: Tx Origin Attacks
在solidity官方文档中已经声明禁止使用tx.origin做认证。
Quote If your wallet had checked msg.sender for authorization, it would get the address of the attack wallet, instead of the owner address. But by checking tx.origin, it gets the original address that kicked off the transaction, which is still the owner address.</div><div class=post-footer><a href=/posts/dasp-access-control-2.html>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/blockchain.html>BlockChain</a>,&nbsp;<a href=/tags/dasp.html>DASP</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/dasp-reentrancy-1.html>#DASP# Reentrancy (1)</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i>Houugen</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-07-20>2018-07-20</time></span>&nbsp;<span class=post-category>included in <a href=/categories/%E5%8C%BA%E5%9D%97%E9%93%BE.html><i class="far fa-folder fa-fw"></i>区块链</a></span></div><div class=content>0x00 Info 从本篇开始学习智能合约漏洞，依据DASP TOP10。
0x01 DAO History:
The History of the DAO WhitePaper:
WhitePaper 白皮书 OpenSource:
Github etherscan 概念理解 众筹合约，通过资金ETH换取DAO token，从而获得投票和发起议案的权利，按一定规则回馈给投资人投资项目的收益。 因此，The DAO特点：
本质是个VC，通过以太坊筹集的资金（ETH）锁定在智能合约中，通过代码主导！ 出资ETH获取对应DAO代币，具有审查项目、投票表决和提出投资项目议案的权利 投资议案由全体代币持有人投票表决，一币一票，票数通过，投资项目可获得相应投资额。利用“众智”+出资额权重决定投资策略（取代传统行业投资经理）。 投资项目的收益按规则回馈股东。 The DAO is attacked the-dao-the-hack-the-soft-fork-and-the-hard-fork
security-alert-dos-vulnerability-in-the-soft-fork
0x02 Reentrancy solidity基础知识 合约调用
message call bytes4 funcIdentifier = bytes4(keccak256("FuncName(paramType)")); this.call(funcIdentifier, paramValue); contract object Contract1 c = Contract1(AddressOfContract1); c.foo(); 限制
例如send花费2300gas 递归调用栈最大1024层 转币</div><div class=post-footer><a href=/posts/dasp-reentrancy-1.html>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/blockchain.html>BlockChain</a>,&nbsp;<a href=/tags/dasp.html>DASP</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%A5%E9%97%A8%E8%B5%84%E6%BA%90.html>BlockChain Resources</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i>Houugen</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-07-12>2018-07-12</time></span>&nbsp;<span class=post-category>included in <a href=/categories/%E5%8C%BA%E5%9D%97%E9%93%BE.html><i class="far fa-folder fa-fw"></i>区块链</a></span></div><div class=content>正所谓不积跬步无以至千里，作为区块链安全学习的第一步，本篇汇聚区块链理论与实践的各种资源，通过知行来理解这个新领域，为安全研究做好伏笔。
BlockChain 区块链技术指南 中文资料阅读站 算法演进 挖矿演进 共识机制演进 自写demo 矿池 PHP-MPOS node-open-mining-portal Powerpool BitCoin 简介：how-bitcoin-works-under-hood whitepaper：bitcoin 中文注解：比特币白皮书 个人翻译+注解 Ethereum 原理 whitepaper: White-Paper 中文：以太坊白皮书 协议架构 https://github.com/ethereum/wiki/wiki/R&D https://ethresear.ch 智能合约 Dapp state wiki：ÐApp Development 入门指南： The Hitchhiker’s Guide to Smart Contracts in Ethereum 以太坊开发入门，完整入门篇 Getting Started with Ethereum and Solidity learning-solidity-part-1-deploy-a-contract 开发事例： Create a Hello World Contract in ethereum Create a Token Contract Create a Crowdsale Contract How to create a private Ethereum network Comments Feed 客户端开发环境 Ethereum Clients IDE： remix truffle 模拟环境：testrpc 客户端： 全节点 geth 轻节点 parity cli：https://ethereum.</div><div class=post-footer><a href=/posts/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%A5%E9%97%A8%E8%B5%84%E6%BA%90.html>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/blockchain.html>BlockChain</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/%E5%86%85%E5%B5%8Creact%E7%9A%84android%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E5%8A%A0%E8%A7%A3%E5%AF%86.html>内嵌React的android应用流量加解密</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i>Houugen</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-05-31>2018-05-31</time></span>&nbsp;<span class=post-category>included in <a href=/categories/android%E7%BD%91%E7%BB%9C.html><i class="far fa-folder fa-fw"></i>android网络</a></span></div><div class=content>0x00 背景 最近在做测试时发现应用使用 facebook 的 react-native 进行混合开发，对于想了解 react-native 的同学，可以查阅github和官方文档，网上也有很多 android 内嵌 react-native 进行混合开发的环境搭建及教程供学习，例如：https://blog.csdn.net/u011148116/article/details/58178348。
该应用核心业务接口数据加密，且加密逻辑在本地js中实现，而测试过程有代理明文抓包改参需求，而研究一二，并记录过程。
0x01 通信加解密历史 终端应用渗透测试包括 客户端&lt;&ndash;通信&ndash;>服务端，客户端测试可以通过各种逆向反编译、动态调试、hook框架分析逻辑及攻击面，而服务端安全则需要通过中间人的方式抓包改参（人工、漏扫、fuzz）来挖掘服务端漏洞。
而现有的app基本都使用https传输，对数据敏感的应用会做二次加密或格式化序列化处理。针对https的原理和绕过可以参考android网络请求-证书认证，而对于二次加密，则需要逆向分析客户端代码了。
常见的加解密逻辑都会在java层或native层，通过url、头关键字、请求关键字、加密算法、log等关键字在反编译代码中搜寻定位。
绕过加密手段有:
hook插件+代理插件的方式 hook插件+server+代理插件的方式 其核心都是在代理中获取明文数据，而明文加密的操作放在插件中。
hook插件+代理插件的方式hook插件+代理插件
" hook插件+代理插件的方式
hook插件+server+代理插件的方式hook插件+server+代理插件
" hook插件+server+代理插件的方式
0x02 react-native js解密 本次测试开始采用通用方式，在反编译代码中搜寻蛛丝马迹，然并卵，本以为请求逻辑做在了native中，简单搜索System.loadLibrary也未确定可疑so文件。
故通过解压apk，全局搜索接口关键字：
grep -rn "xxx" . 在 assets 文件下的js文件中发现关键字：
可确定使用js+android混合开发，而网络请求与数据加密均由js实现。
那我们思路就是js强制发明文，经过burp加密发送；或者经过server加密，burp发送加密数据。
ok，思路清晰后，我们就要带着如下问题进行尝试：
Question js中post数据构成逻辑为何？如何强制明文？ 两种方式工作量对比，若采用burp加密，是复现js加密算法，还是加载js？若采用server加密，改如何构建c（burp）-s（server）？ server我使用擅长的python实现，那如何在python中运行js？ 首先来看第一个问题：
js文件index.android.bundle未做加密和强混淆，通过格式化即可看到代码原貌，通过关键字（箭头所指）确定发送请求和参数构造（图中文字）代码： 而参数经过一系列函数的运算加密生成： 发送明文也很简单，直接修改js代码 return r 即可，这里也打消在burp插件中复现js加密逻辑的想法，真的很复杂。
Info 这里因为修改了apk的资源文件，重压缩打包后需要签名，否则安装报错。 接着看第二个问题：</div><div class=post-footer><a href=/posts/%E5%86%85%E5%B5%8Creact%E7%9A%84android%E5%BA%94%E7%94%A8%E6%B5%81%E9%87%8F%E5%8A%A0%E8%A7%A3%E5%AF%86.html>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/burp.html>burp</a>,&nbsp;<a href=/tags/react-native.html>react-native</a></div></div></article><ul class=pagination><li class=page-item><span class=page-link><a href=/>1</a></span></li><li class=page-item><span class=page-link><a href=/page/2.html>2</a></span></li><li class=page-item><span class=page-link><a href=/page/3.html>3</a></span></li><li class="page-item active"><span class=page-link><a href=/page/4.html>4</a></span></li><li class=page-item><span class=page-link><a href=/page/5.html>5</a></span></li></ul></div></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2021</span>&nbsp;|&nbsp;<span class=license>Houugen</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:20},data:{"id-1":"「不识香烟味 人生损大半」- モブサイコ100"},search:{algoliaAppID:"63ROI1DYLO",algoliaIndex:"houugen_blog",algoliaSearchKey:"0282c2777b386667ccc099a27da8a3cb",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"},typeit:{cursorChar:null,cursorSpeed:null,data:{"id-1":["id-1"]},duration:null,speed:null}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>